{% extends "base.html" %}

{% block title %}Add New Customer - Customer Management System{% endblock %}

{% block content %}





<style>
    @keyframes float {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        33% { transform: translate(30px, -30px) rotate(120deg); }
        66% { transform: translate(-20px, 20px) rotate(240deg); }
    }
    
    @keyframes pulse-soft {
        0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
        50% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.05); }
    }
    
    .animate-float {
        animation: float 20s ease-in-out infinite;
    }
    
    .animate-pulse-soft {
        animation: pulse-soft 8s ease-in-out infinite;
    }
</style>

     <!-- Advanced Background Elements -->
     <div class="fixed inset-0 overflow-hidden pointer-events-none">
         <div class="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-purple-600/20 rounded-full blur-3xl animate-float"></div>
         <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-indigo-400/20 to-cyan-600/20 rounded-full blur-3xl animate-float" style="animation-delay: -1s;"></div>
         <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-72 h-72 bg-gradient-to-r from-pink-400/10 to-yellow-400/10 rounded-full blur-3xl animate-pulse-soft"></div>
   </div>

<div class="p-4 bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- Page Header -->
    <div class="mb-6">
        <nav class="flex" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="/" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
                        <svg class="w-3 h-3 mr-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"/>
                        </svg>
                        Home
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <svg class="w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                        </svg>
                        <a href="/customers" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2 dark:text-gray-400 dark:hover:text-white">Customers</a>
                    </div>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <svg class="w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                        </svg>
                        <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400">Add Customer</span>
                    </div>
                </li>
            </ol>
        </nav>
        
        <div class="mt-4">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Add New Customer</h1>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Create a new customer profile with complete information.</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Main Form - Takes 3 columns -->
        <div class="lg:col-span-3">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="p-6">
                    <form id="add-customer-form" enctype="multipart/form-data" class="space-y-6">
                        
                        <!-- Customer Type Section -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-orange-100 dark:bg-orange-900 rounded-lg">
                                    <svg class="w-5 h-5 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Customer Type</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Select the type of customer</p>
                                </div>
                            </div>
                            
                            <div>
                                <label for="customer_type" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Customer Type</label>
                                <select id="customer_type" name="customer_type" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                    <option value="">Select customer type</option>
                                    <option value="INDIVIDUAL">Individual</option>
                                    <option value="COMMERCIAL">Commercial</option>
                                </select>
                            </div>
                        </div>

                        <!-- Profile Image Section -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                    <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Profile Image</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Add a profile picture for easy identification</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-6">
                                <!-- Image Preview -->
                                <div class="relative">
                                    <div class="w-24 h-24 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden">
                                        <img id="customer-preview" class="w-full h-full object-cover hidden" src="#" alt="Preview">
                                        <img id="default-icon" class="w-full h-full object-cover" src="{{ url_for('static', filename='uploads/customers/default_profile.png') }}" alt="Default profile picture">
                                    </div>
                                    <button type="button" id="preview-remove-btn" onclick="removeImage()" class="absolute -top-2 -right-2 hidden p-1 bg-red-500 rounded-full text-white hover:bg-red-600 transition-colors">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                                
                                <!-- Upload Area -->
                                <div class="flex-1">
                                    <label for="customer-image" class="flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500">
                                        <div class="flex flex-col items-center justify-center pt-2 pb-2">
                                            <svg class="w-6 h-6 mb-1 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                            </svg>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Click to upload or drag and drop</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">SVG, PNG, JPG or GIF (MAX. 5MB)</p>
                                        </div>
                                        <input id="customer-image" type="file" class="hidden" accept="image/*" onchange="previewImage(this)">
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Personal Information -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-green-100 dark:bg-green-900 rounded-lg">
                                    <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Personal Information</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Enter the customer's basic details</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-4">
                                <!-- Customer Name -->
                                <div>
                                    <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Full Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="name" name="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Enter customer's full name" required>
                                </div>

                                <!-- Workplace -->
                                <div>
                                    <label for="workplace" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Workplace/Company</label>
                                    <input type="text" id="workplace" name="workplace" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Company name or workplace">
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
                                    <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Contact Information</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">How to reach the customer</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Email -->
                                <div class="md:col-span-2">
                                    <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email Address</label>
                                    <input type="email" id="email" name="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="customer@example.com">
                                </div>

                                <!-- Mobile Phone -->
                                <div>
                                    <label for="phone" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Mobile Number <span class="text-red-500">*</span>
                                    </label>
                                    <input type="tel" id="phone" name="phone" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="+966 50 123 4567" required>
                                </div>

                                <!-- Phone Number -->
                                <div>
                                    <label for="phone_number" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Phone Number</label>
                                    <input type="tel" id="phone_number" name="phone_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="+966 1 234 5678">
                                </div>
                            </div>
                        </div>

                        <!-- Address Information -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-teal-100 dark:bg-teal-900 rounded-lg">
                                    <svg class="w-5 h-5 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Address Information</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Customer's address details</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Street Address 1 -->
                                <div class="md:col-span-2">
                                    <label for="street_address_1" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Street Address 1</label>
                                    <input type="text" id="street_address_1" name="street_address_1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Building number, street name">
                                </div>

                                <!-- Street Address 2 -->
                                <div class="md:col-span-2">
                                    <label for="street_address_2" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Street Address 2</label>
                                    <input type="text" id="street_address_2" name="street_address_2" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Apartment, suite, unit, etc.">
                                </div>

                                <!-- Country -->
                                <div>
                                    <label for="country" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Country</label>
                                    <input type="text" id="country" name="country" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Saudi Arabia">
                                </div>

                                <!-- City -->
                                <div>
                                    <label for="city" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">City</label>
                                    <input type="text" id="city" name="city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Riyadh">
                                </div>

                                <!-- Region -->
                                <div>
                                    <label for="region" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Region/State</label>
                                    <input type="text" id="region" name="region" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Riyadh Region">
                                </div>

                                <!-- Postal Code -->
                                <div>
                                    <label for="postal_code" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Postal Code</label>
                                    <input type="text" id="postal_code" name="postal_code" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="12345">
                                </div>
                            </div>
                        </div>

                        <!-- Business Information -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-cyan-100 dark:bg-cyan-900 rounded-lg">
                                    <svg class="w-5 h-5 text-cyan-600 dark:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Business Information</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Tax and commercial registration details</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Tax ID -->
                                <div>
                                    <label for="tax_id" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tax ID Number</label>
                                    <input type="text" id="tax_id" name="tax_id" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="123456789012345">
                                </div>

                                <!-- Commercial Register -->
                                <div>
                                    <label for="commercial_register" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Commercial Register</label>
                                    <input type="text" id="commercial_register" name="commercial_register" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="1010123456">
                                </div>
                            </div>
                        </div>

                        <!-- Account Settings -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-indigo-100 dark:bg-indigo-900 rounded-lg">
                                    <svg class="w-5 h-5 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Account Settings</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Customer status, rating, and join date</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <!-- Customer Code -->
                                <div>
                                    <label for="customer_code" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Customer Code <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="customer_code" name="customer_code" class="bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Auto-generated" readonly required>
                                </div>

                                <!-- Status -->
                                <div>
                                    <label for="status" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Customer Status</label>
                                    <select id="status" name="status" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                        <option value="ACTIVE" selected>Active</option>
                                        <option value="INACTIVE">Inactive</option>
                                        <option value="SUSPENDED">Suspended</option>
                                    </select>
                                </div>

                                <!-- Invoice Method -->
                                <div>
                                    <label for="invoice_method" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Invoice Method</label>
                                    <select id="invoice_method" name="invoice_method" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                        <option value="">Select method</option>
                                        <option value="ELECTRONIC">Electronic</option>
                                        <option value="PRINT">Print</option>
                                    </select>
                                </div>

                                <!-- Join Date -->
                                <div>
                                    <label for="join_date" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Join Date <span class="text-red-500">*</span>
                                    </label>
                                    <input datepicker datepicker-format="dd-mm-yyyy" type="text" id="join_date" name="join_date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date" readonly required>
                                </div>
                            </div>

                            <!-- Rating Section -->
                            <div class="mt-4">
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Customer Rating</label>
                                <div class="flex items-center space-x-1">
                                    <input type="radio" id="star5" name="rating" value="5" class="hidden">
                                    <label for="star5" class="cursor-pointer">
                                        <svg class="w-6 h-6 text-gray-300 hover:text-yellow-400 transition-colors star-icon" fill="currentColor" viewBox="0 0 22 20">
                                            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                                        </svg>
                                    </label>
                                    <input type="radio" id="star4" name="rating" value="4" class="hidden">
                                    <label for="star4" class="cursor-pointer">
                                        <svg class="w-6 h-6 text-gray-300 hover:text-yellow-400 transition-colors star-icon" fill="currentColor" viewBox="0 0 22 20">
                                            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                                        </svg>
                                    </label>
                                    <input type="radio" id="star3" name="rating" value="3" class="hidden">
                                    <label for="star3" class="cursor-pointer">
                                        <svg class="w-6 h-6 text-gray-300 hover:text-yellow-400 transition-colors star-icon" fill="currentColor" viewBox="0 0 22 20">
                                            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                                        </svg>
                                    </label>
                                    <input type="radio" id="star2" name="rating" value="2" class="hidden">
                                    <label for="star2" class="cursor-pointer">
                                        <svg class="w-6 h-6 text-gray-300 hover:text-yellow-400 transition-colors star-icon" fill="currentColor" viewBox="0 0 22 20">
                                            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                                        </svg>
                                    </label>
                                    <input type="radio" id="star1" name="rating" value="1" class="hidden">
                                    <label for="star1" class="cursor-pointer">
                                        <svg class="w-6 h-6 text-gray-300 hover:text-yellow-400 transition-colors star-icon" fill="currentColor" viewBox="0 0 22 20">
                                            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                                        </svg>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Financial Information -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-yellow-100 dark:bg-yellow-900 rounded-lg">
                                    <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Financial Information</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Outstanding balance and debt amount</p>
                                </div>
                            </div>
                            
                            <div>
                                <label for="debt_amount" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Debt Amount (SAR)</label>
                                <input type="number" id="debt_amount" name="debt_amount" min="0" step="0.01" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="0.00">
                            </div>
                        </div>

                        <!-- Attachments -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-pink-100 dark:bg-pink-900 rounded-lg">
                                    <svg class="w-5 h-5 text-pink-600 dark:text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Attachments</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Upload important documents for the customer</p>
                                </div>
                            </div>
                            
                            <div>
                                <label for="customer-attachments" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Customer Documents</label>
                                <div class="flex items-center justify-center w-full">
                                    <label for="customer-attachments" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                            </svg>
                                            <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (MAX. 10MB each)</p>
                                        </div>
                                        <input id="customer-attachments" type="file" name="customer-attachments" class="hidden" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" onchange="handleAttachments(this)">
                                    </label>
                                </div>
                                
                                <!-- Uploaded Files List -->
                                <div id="uploaded-files-list" class="mt-4 space-y-2 hidden">
                                    <h4 class="text-sm font-medium text-gray-900 dark:text-white">Uploaded Files:</h4>
                                    <div id="files-container" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div>
                            <div class="flex items-center gap-4 mb-4">
                                <div class="flex-shrink-0 p-2 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Additional Information</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Notes and special information</p>
                                </div>
                            </div>
                            
                            <div>
                                <label for="notes" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Notes</label>
                                <textarea id="notes" name="notes" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Add any special notes about the customer..."></textarea>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200 dark:border-gray-700">
                            <a href="/customers" class="w-full sm:w-auto text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 text-center dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700">
                                Back to Customers
                            </a>
                            <button type="submit" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                                Create Customer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar - Takes 1 column -->
        <div class="lg:col-span-1 space-y-4">
            <!-- Quick Tips -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="flex-shrink-0 p-1 bg-blue-100 dark:bg-blue-900 rounded">
                            <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white">Quick Tips</h4>
                    </div>
                    <ul class="space-y-2 text-xs text-gray-600 dark:text-gray-400">
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-red-500 mt-1.5 flex-shrink-0"></div>
                            <span>Customer code is auto-generated and required</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-green-500 mt-1.5 flex-shrink-0"></div>
                            <span>Name, mobile number and join date are required</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-blue-500 mt-1.5 flex-shrink-0"></div>
                            <span>Profile image is optional but recommended</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-purple-500 mt-1.5 flex-shrink-0"></div>
                            <span>Use ratings to prioritize important customers</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"></div>
                            <span>Customer type helps categorize clients</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-pink-500 mt-1.5 flex-shrink-0"></div>
                            <span>Attachments support PDF, Office docs and images</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <div class="w-1 h-1 rounded-full bg-teal-500 mt-1.5 flex-shrink-0"></div>
                            <span>Address and tax info is optional</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Customer Status Legend -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="flex-shrink-0 p-1 bg-green-100 dark:bg-green-900 rounded">
                            <svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white">Status Guide</h4>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Active: Regular customer</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Inactive: Not active recently</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Suspended: Account suspended</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Types Guide -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="flex-shrink-0 p-1 bg-orange-100 dark:bg-orange-900 rounded">
                            <svg class="w-4 h-4 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white">Customer Types</h4>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Individual: Personal customers</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Commercial: Business customers</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invoice Methods Guide -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="flex-shrink-0 p-1 bg-indigo-100 dark:bg-indigo-900 rounded">
                            <svg class="w-4 h-4 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white">Invoice Methods</h4>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-cyan-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Electronic: Digital invoices</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Print: Physical printed invoices</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

<script>
// Image preview functionality
function previewImage(input) {
    const preview = document.getElementById('customer-preview');
    const defaultIcon = document.getElementById('default-icon');
    const previewRemoveBtn = document.getElementById('preview-remove-btn');

    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Validate file type
        if (!file.type.startsWith('image/')) {
            showToast('error', 'Please select a valid image file!');
            return;
        }
        
        // Validate file size (5MB)
        if (file.size > 5 * 1024 * 1024) {
            showToast('error', 'Image size must be less than 5MB!');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.remove('hidden');
            defaultIcon.classList.add('hidden');
            previewRemoveBtn.classList.remove('hidden');
            showToast('success', 'Image uploaded successfully!');
        }
        reader.readAsDataURL(file);
    }
}

function removeImage() {
    const preview = document.getElementById('customer-preview');
    const defaultIcon = document.getElementById('default-icon');
    const previewRemoveBtn = document.getElementById('preview-remove-btn');
    const input = document.getElementById('customer-image');
    
    preview.src = '#';
    preview.classList.add('hidden');
    defaultIcon.classList.remove('hidden');
    previewRemoveBtn.classList.add('hidden');
    input.value = '';
    
    showToast('success', 'Image removed');
}



// Handle attachments
function handleAttachments(input) {
    const filesList = document.getElementById('uploaded-files-list');
    const filesContainer = document.getElementById('files-container');
    
    if (input.files && input.files.length > 0) {
        filesList.classList.remove('hidden');
        filesContainer.innerHTML = '';
        
        Array.from(input.files).forEach((file, index) => {
            // Validate file size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('error', `File "${file.name}" is too large. Maximum size is 10MB.`);
                return;
            }
            
            const fileElement = document.createElement('div');
            fileElement.className = 'flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600';
            
            const fileInfo = document.createElement('div');
            fileInfo.className = 'flex items-center gap-3';
            
            const fileIcon = getFileIcon(file.type);
            const fileName = document.createElement('span');
            fileName.className = 'text-sm text-gray-900 dark:text-white font-medium';
            fileName.textContent = file.name;
            
            const fileSize = document.createElement('span');
            fileSize.className = 'text-xs text-gray-500 dark:text-gray-400';
            fileSize.textContent = formatFileSize(file.size);
            
            fileInfo.appendChild(fileIcon);
            const textContainer = document.createElement('div');
            textContainer.appendChild(fileName);
            textContainer.appendChild(fileSize);
            fileInfo.appendChild(textContainer);
            
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300';
            removeButton.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
            removeButton.onclick = () => removeFile(index, input);
            
            fileElement.appendChild(fileInfo);
            fileElement.appendChild(removeButton);
            filesContainer.appendChild(fileElement);
        });
        
        showToast('success', `${input.files.length} file(s) selected successfully!`);
    } else {
        filesList.classList.add('hidden');
    }
}

function getFileIcon(fileType) {
    const icon = document.createElement('div');
    icon.className = 'flex-shrink-0 w-8 h-8 flex items-center justify-center rounded';
    
    if (fileType.includes('pdf')) {
        icon.className += ' bg-red-100 dark:bg-red-900';
        icon.innerHTML = '<svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="currentColor" viewBox="0 0 20 20"><path d="M4 18h12V6l-4-4H4v16zm8-14v4h4l-4-4z"/></svg>';
    } else if (fileType.includes('sheet') || fileType.includes('excel')) {
        icon.className += ' bg-green-100 dark:bg-green-900';
        icon.innerHTML = '<svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20"><path d="M4 2h12v16H4V2zm2 2v12h8V4H6z"/></svg>';
    } else if (fileType.includes('word') || fileType.includes('document')) {
        icon.className += ' bg-blue-100 dark:bg-blue-900';
        icon.innerHTML = '<svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path d="M4 2h12v16H4V2zm2 2v12h8V4H6z"/></svg>';
    } else if (fileType.includes('image')) {
        icon.className += ' bg-purple-100 dark:bg-purple-900';
        icon.innerHTML = '<svg class="w-4 h-4 text-purple-600 dark:text-purple-400" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3h12v14H4V3zm2 2v10h8V5H6z"/></svg>';
    } else {
        icon.className += ' bg-gray-100 dark:bg-gray-600';
        icon.innerHTML = '<svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path d="M4 2h12v16H4V2zm2 2v12h8V4H6z"/></svg>';
    }
    
    return icon;
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function removeFile(index, input) {
    const dt = new DataTransfer();
    const files = Array.from(input.files);
    
    files.splice(index, 1);
    files.forEach(file => dt.items.add(file));
    
    input.files = dt.files;
    handleAttachments(input);
}

// Generate customer code when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Generate customer code
    const customerCodeField = document.getElementById('customer_code');
    const timestamp = Date.now().toString().slice(-6);
    const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    customerCodeField.value = `CUST-${timestamp}${randomNum}`;
    
    // Star rating functionality (existing code)
    const starInputs = document.querySelectorAll('input[name="rating"]');
    const starLabels = document.querySelectorAll('.star-icon');
    
    starInputs.forEach(input => {
        input.addEventListener('change', function() {
            const rating = parseInt(this.value);
            updateStars(rating);
            showToast('success', `Rating set to ${rating} star${rating > 1 ? 's' : ''}`);
        });
    });
    
    function updateStars(rating) {
        starLabels.forEach((star, index) => {
            if (index < rating) {
                star.classList.remove('text-gray-300');
                star.classList.add('text-yellow-400');
            } else {
                star.classList.remove('text-yellow-400');
                star.classList.add('text-gray-300');
            }
        });
    }
});

// Form submission
document.getElementById('add-customer-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate required fields
    const requiredFields = ['name', 'phone', 'join_date', 'customer_code'];
    let hasErrors = false;
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
            hasErrors = true;
            field.classList.add('border-red-500');
            setTimeout(() => field.classList.remove('border-red-500'), 3000);
        }
    });
    
    if (hasErrors) {
        showToast('error', 'Please fill in all required fields!');
        return;
    }
    
    const formData = new FormData(this);
    const imageInput = document.getElementById('customer-image');
    if (imageInput.files && imageInput.files[0]) {
        formData.append('customer-image', imageInput.files[0]);
    }
    
    // Add attachments
    const attachmentsInput = document.getElementById('customer-attachments');
    if (attachmentsInput.files && attachmentsInput.files.length > 0) {
        Array.from(attachmentsInput.files).forEach((file, index) => {
            formData.append(`attachment-${index}`, file);
        });
    }
    
    const submitButton = this.querySelector('button[type="submit"]');
    const originalText = submitButton.innerHTML;
    
    submitButton.innerHTML = 'Creating...';
    submitButton.disabled = true;
    
    fetch("{{ url_for('customer.add_customer') }}", {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
        
        showToast(data.success ? 'success' : 'error', data.message);
        
        if (data.success) {
            setTimeout(() => {
                window.location.href = '/customers';
            }, 2000);
        }
    })
    .catch(error => {
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
        console.error('Error:', error);
        showToast('error', 'An error occurred while creating the customer. Please try again.');
    });
});

// Toast notification function
function showToast(type, message) {
    const toastContainer = document.getElementById('toast-container');
    const toastId = 'toast-' + Date.now();
    
    const iconPath = type === 'success' 
        ? 'M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z'
        : 'M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z';
    
    const colorClasses = type === 'success' 
        ? 'text-green-500 bg-green-100 dark:bg-green-800 dark:text-green-200'
        : 'text-red-500 bg-red-100 dark:bg-red-800 dark:text-red-200';
    
    const toastHTML = `
        <div id="${toastId}" class="flex items-center w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800" role="alert">
            <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 ${colorClasses} rounded-lg">
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="${iconPath}"/>
                </svg>
            </div>
            <div class="ml-3 text-sm font-normal">${message}</div>
            <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" onclick="document.getElementById('${toastId}').remove()">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
            </button>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        const toast = document.getElementById(toastId);
        if (toast) toast.remove();
    }, 5000);
}
</script>

{% endblock %}